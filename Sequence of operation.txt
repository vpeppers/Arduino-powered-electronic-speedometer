Sequence of Operation

When the ignition switch is turned on, and the circuit is energized, a series of initializations begin.  The latest location data is retrieved from memory, and consistency checked.  If that fails, the next record is retrieved and checked.  This continues until a reliable record is found.  Then the time is retrieved from the real-time clock.  From this, the latest odometer reading, latest trip odometer reading, and the location data are extracted.  The location data is then sent to the GPS unit to initialize it.  Using this data, the GPS is able to find the satellites much quicker, and start providing location data.  The latest odometer readings are also written to the appropriate OLED screens.

After all of the start-up procedures finish, the system then starts every quarter of a second polling the GPS for location, time, and speed.  The location data is used to calculate the distance traveled since the last cycle.  The odometer and trip odometer are then updated with the new distances.  The odometer readings and the location are then stored in the memory in a series of records along with a CRC check, a sequence number, and a commit byte to ensure that the record was written completely.  The time data is used to reset the real-time clock to ensure that the correct time is provided by the clock.  Finally, the current speed is averaged over the last five readings to smooth needle movement.  This average is used to calculate how many steps that the speedometer motor must make to indicate the correct speed, and the speedometer moter is moved as required.

The cycle waits until the next quarter of a second passes and then starts over.  The cycle is timed to start every quarter of a second rather than delaying a quarter of a second to allow for the various operations to be complete, without knowing how long that will take.  This provides a consistent cycle length, giving a steady speed indication.